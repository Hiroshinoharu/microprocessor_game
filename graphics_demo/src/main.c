#include <stm32f031x6.h>
#include "display.h"
#include "prbs.h"
#include "sound.h"
#include "musical_notes.h"
#include "serial.h"

//Symbolic Name for the Bridge blocks
# define BLOCK_COUNT_TOP 6
# define BLOCK_COUNT_BOTTOM 7
# define BLOCK_COUNT_SIDE 4

//Basic Game Structure
void display_begin();
void initClock(void);
void initSysTick(void);
void SysTick_Handler(void);
void delay(volatile uint32_t dly);
void setupIO();
int isInside(uint16_t x1, uint16_t y1, uint16_t w, uint16_t h, uint16_t px, uint16_t py);
void enablePullUp(GPIO_TypeDef *Port, uint32_t BitNumber);
void pinMode(GPIO_TypeDef *Port, uint32_t BitNumber, uint32_t Mode);


//Signature to render the game's textures
void renderGame(void);
void renderAssets(void);
void setUpSystem(void);
void renderBarriers(void);

//Button Movement 
int leftPressed(void);
int rightPressed(void);
int upPressed(void);
int downPressed(void);

//Signature for the Game Over screen
void gameOver(void);

//Signature for the Level Completed Screen
void levelCompleted(void);

//Siganture to check if the player inside the enemy.
void playerInsideEnemy(uint16_t,uint16_t,uint16_t,uint16_t);

//Signature to check if the player is inside the meat
void playerInsideMeat(uint16_t,uint16_t,uint16_t,uint16_t);

//Signature to check if enemy hit player
void enemyInsidePlayer(uint16_t,uint16_t,uint16_t,uint16_t);

//Signature to check if the player hits the ocean
int hitOcean(uint16_t,uint16_t,uint16_t,uint16_t);

//Signature to generate a second level
void level2(void);

volatile uint32_t milliseconds;

//Barriers are set to the top-left corner 
const uint16_t barrierX[BLOCK_COUNT_TOP] = {30,30,30,30,30,30};
const uint16_t barrierY[BLOCK_COUNT_TOP] = {0,10,20,30,40,50};

//Barriers are set to the top-right corner 
const uint16_t barrier2X[BLOCK_COUNT_TOP] = {80,80,80,80,80,80};
const uint16_t barrier2Y[BLOCK_COUNT_TOP] = {0,10,20,30,40,50};

//Barriers are set to the bottom-left of the corner
const uint16_t barrier3X[BLOCK_COUNT_BOTTOM] = {30,30,30,30,30,30,30};
const uint16_t barrier3Y[BLOCK_COUNT_BOTTOM] = {145,135,125,115,105,95,85};

//Barriers are set to the bottom-right of the corner
const uint16_t barrier4X[BLOCK_COUNT_BOTTOM] = {80,80,80,80,80,80,80};
const uint16_t barrier4Y[BLOCK_COUNT_BOTTOM] = {145,135,125,115,105,95,85};

//Barrier set with the side bridge
const uint16_t side_barrierX[BLOCK_COUNT_SIDE] = {0,10,20,30};
const uint16_t side_barrierY[BLOCK_COUNT_SIDE] = {85,85,85,85};

const uint16_t side_barrier2X[BLOCK_COUNT_SIDE] = {0,10,20,30};
const uint16_t side_barrier2Y[BLOCK_COUNT_SIDE] = {49,49,49,49};

const uint16_t side_barrier3X[BLOCK_COUNT_SIDE] = {80,90,100,110};
const uint16_t side_barrier3Y[BLOCK_COUNT_SIDE] = {85,85,85,85};

const uint16_t side_barrier4X[BLOCK_COUNT_SIDE] = {80,90,100,110};
const uint16_t side_barrier4Y[BLOCK_COUNT_SIDE] = {49,49,49,49};


const uint16_t luffy1[]=
{
	27649,27649,27649,16142,16142,16142,16142,16142,16142,27649,27649,27649,27649,27649,27649,40224,40224,40224,40224,40224,40224,27649,27649,27649,27649,27649,16142,16142,16142,16142,16142,16142,16142,16142,27649,27649,27649,27649,27649,51505,51505,51505,51505,51505,51505,27649,27649,27649,27649,27649,27649,65535,0,40375,40375,0,65535,27649,27649,27649,27649,27649,27649,40375,40375,40375,40375,40375,40375,27649,27649,27649,27649,40375,40375,40224,40224,40375,40375,40224,40224,40375,40375,27649,27649,40375,40375,40224,40224,40375,40375,40224,40224,40375,40375,27649,27649,40375,40375,40224,40224,40375,40375,40224,40224,40375,40375,27649,27649,40375,40375,40224,40224,40375,40375,40224,40224,40375,40375,27649,27649,40375,40375,40224,40224,40375,40375,40224,40224,40375,40375,27649,27649,27649,27649,16621,16621,16621,16621,16621,16621,27649,27649,27649,27649,27649,27649,16621,16621,16621,16621,16621,16621,27649,27649,27649,27649,27649,27649,65535,65535,27649,27649,65535,65535,27649,27649,27649,27649,27649,27649,40375,40375,27649,27649,40375,40375,27649,27649,27649,27649,27649,27649,22355,22355,27649,27649,22355,22355,27649,27649,27649,
};

const uint16_t luffy2[] =
{
	27649,27649,27649,16142,16142,16142,16142,16142,16142,27649,27649,27649,27649,27649,27649,40224,40224,40224,40224,40224,40224,27649,27649,27649,27649,27649,16142,16142,16142,16142,16142,16142,16142,16142,27649,27649,27649,27649,27649,51505,51505,51505,51505,51505,51505,27649,27649,27649,27649,27649,27649,51505,51505,51505,51505,51505,51505,27649,27649,27649,27649,27649,27649,51505,51505,51505,51505,51505,51505,27649,27649,27649,27649,40375,40375,40224,40224,40224,40224,40224,40224,40375,40375,27649,27649,40375,40375,40224,40224,40224,40224,40224,40224,40375,40375,27649,27649,40375,40375,40224,40224,40224,40224,40224,40224,40375,40375,27649,27649,40375,40375,40224,40224,40224,40224,40224,40224,40375,40375,27649,27649,40375,40375,40224,40224,40224,40224,40224,40224,40375,40375,27649,27649,27649,27649,16621,16621,16621,16621,16621,16621,27649,27649,27649,27649,27649,27649,16621,16621,16621,16621,16621,16621,27649,27649,27649,27649,27649,27649,65535,65535,27649,27649,65535,65535,27649,27649,27649,27649,27649,27649,40375,40375,27649,27649,40375,40375,27649,27649,27649,27649,27649,27649,22355,22355,27649,27649,22355,22355,27649,27649,27649,
};

const uint16_t luffy3[] = 
{
	27649,27649,27649,16142,16142,16142,16142,27649,27649,27649,27649,27649,27649,27649,27649,40224,40224,40224,40224,27649,27649,27649,27649,27649,27649,27649,16142,16142,16142,16142,16142,16142,27649,27649,27649,27649,27649,27649,27649,51505,51505,51505,51505,65535,27649,27649,27649,27649,27649,27649,27649,51505,51505,51505,51505,40375,40375,27649,27649,27649,27649,27649,27649,51505,51505,51505,51505,40375,27649,27649,27649,27649,27649,27649,27649,40224,40224,40224,40224,27649,27649,27649,27649,27649,27649,27649,27649,40224,40375,40375,40224,27649,27649,27649,27649,27649,27649,27649,27649,40224,40375,40375,40224,27649,27649,27649,27649,27649,27649,27649,27649,40224,40375,40375,40224,27649,27649,27649,27649,27649,27649,27649,27649,40224,40375,40375,40224,27649,27649,27649,27649,27649,27649,27649,27649,16621,16621,16621,16621,27649,27649,27649,27649,27649,27649,27649,27649,16621,16621,16621,16621,27649,27649,27649,27649,27649,27649,27649,27649,65535,27649,27649,65535,27649,27649,27649,27649,27649,27649,27649,40375,40375,27649,27649,40375,40375,27649,27649,27649,27649,27649,27649,22355,22355,27649,27649,22355,22355,27649,27649,27649,27649,
};

const uint16_t luffy4[] =
{
	27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,40375,40375,27649,27649,27649,27649,27649,27649,27649,27649,27649,16142,16142,16142,16142,27649,27649,27649,27649,27649,27649,27649,16142,40224,40224,40224,40224,16142,27649,27649,27649,27649,40375,40375,16142,40224,16142,16142,40224,16142,40375,40375,27649,27649,40375,40375,16142,40224,16142,16142,40224,16142,40375,40375,27649,27649,27649,27649,16142,40224,40224,40224,40224,16142,27649,27649,27649,27649,27649,27649,27649,16142,16142,16142,16142,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,
};

const uint16_t meat[] =
{
	27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,65535,65535,65535,65535,27649,27649,27649,27649,27649,27649,27649,27649,27649,65535,65535,27649,27649,27649,27649,27649,27649,27649,27649,27649,22355,22355,22355,22355,27649,27649,27649,27649,27649,27649,27649,27649,22355,22355,22355,22355,27649,27649,27649,27649,27649,27649,27649,27649,22355,22355,22355,22355,27649,27649,27649,27649,27649,27649,27649,27649,22355,22355,22355,22355,27649,27649,27649,27649,27649,27649,27649,27649,22355,22355,22355,22355,27649,27649,27649,27649,27649,27649,27649,27649,27649,65535,65535,27649,27649,27649,27649,27649,27649,27649,27649,27649,65535,65535,65535,65535,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,
};

const uint16_t enemy[] =
{
	27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,1994,1994,1994,1994,27649,27649,27649,27649,27649,27649,27649,1994,1994,1994,1994,1994,1994,27649,27649,27649,27649,27649,27649,1994,1994,1994,1994,1994,1994,27649,27649,27649,27649,27649,27649,65535,0,40375,40375,0,65535,27649,27649,27649,61307,27649,27649,40375,40375,40375,40375,40375,40375,27649,27649,61307,61307,27649,27649,22355,22355,22355,22355,22355,22355,27649,27649,61307,61307,27649,27649,22355,22355,22355,22355,22355,22355,27649,27649,61307,61307,27649,13294,13294,13294,13294,13294,13294,13294,13294,27649,27649,61307,27649,65535,13294,65535,65535,65535,65535,13294,65535,27649,24327,24327,27649,13294,13294,13294,13294,13294,13294,13294,13294,27649,27649,61307,40375,65535,13294,65535,65535,65535,65535,13294,65535,27649,27649,27649,27649,27649,4368,4368,4368,4368,4368,4368,40375,27649,27649,27649,27649,27649,61307,61307,61307,61307,61307,4368,27649,27649,27649,27649,27649,27649,61307,61307,27649,27649,61307,61307,27649,27649,27649,27649,27649,27649,61307,61307,27649,27649,61307,61307,27649,27649,
};

const uint16_t delete[] = 
{
	27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,27649,
};

const uint16_t barrier[] =
{
	59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,59132,
};

const uint16_t skull[] =
{
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8265,16523,24706,16515,16457,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8265,16523,24706,16515,16457,0,0,0,0,0,0,0,8241,212,8282,41041,57433,49356,24625,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,57376,40984,40984,40984,40984,40984,40984,40984,40984,49184,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16433,41164,57433,41041,90,212,16433,0,0,0,0,0,8216,8388,41395,34081,1305,17689,25003,8388,16408,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24633,212,41156,41156,41156,41156,41156,41156,41156,41156,41156,32956,212,32833,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8216,8388,25003,25889,1305,34081,33203,8388,16408,0,0,0,0,16498,81,34089,40431,57079,56815,17969,32841,8306,0,0,0,0,0,0,0,0,0,0,0,8,16523,16539,41180,24673,8,8,8,8,8,8,8,8,8,8,8289,49372,16539,24715,8200,0,0,0,0,0,0,0,0,0,0,0,8306,41041,9777,48623,57079,48623,42537,57425,24690,0,0,0,0,24698,32833,17689,40959,65535,65535,26401,57401,41082,0,0,0,0,0,0,0,0,0,0,0,8355,8363,24723,41098,27178,3851,52746,52746,52746,52746,52746,52746,52746,52746,3851,27178,41098,24723,8363,16547,0,0,0,0,0,0,0,0,0,0,0,49274,57,17953,65535,65535,49151,25881,24641,32890,0,0,32898,41090,16572,32833,42537,8191,49151,40695,58921,73,16514,0,0,0,0,0,0,0,0,57401,32907,57491,32980,16392,0,0,55316,16167,40742,40742,40742,40742,40742,40742,40742,40742,16167,63508,0,0,8200,24788,147,32907,57,0,0,0,0,0,0,0,0,16514,8265,50729,32503,49151,16383,50729,24641,24764,41090,32898,32833,57401,49,45468,31446,65535,62356,9513,16811,220,8249,0,0,0,0,0,0,0,24625,32906,57425,73,49457,5660,63517,22557,40230,32550,16166,16166,16166,16166,16166,16166,16166,16166,32550,40230,22557,55325,13852,49713,73,57425,24714,32817,0,0,0,0,0,0,0,57,220,16811,9513,54164,65535,31446,53660,49,57401,32833,1841,34609,42801,31446,65535,65535,13212,34089,427,32972,8,0,0,0,0,0,0,8273,16588,8835,10241,1793,2562,48934,65318,24358,32550,65318,7974,7974,7974,7974,7974,7974,7974,7974,65318,32550,24358,65318,57126,10754,59137,10241,643,16588,16465,0,0,0,0,0,0,57352,24780,8619,42281,5012,65535,65535,47830,42801,34609,1841,48887,57343,57343,65535,65535,65535,65535,7935,9497,8232,32980,49241,0,0,0,0,57442,16629,32800,18689,65318,16166,65318,7974,7974,7974,7974,7974,7974,7974,7974,7974,7974,7974,7974,7974,7974,7974,7974,7974,7974,65318,7974,65318,35073,24608,16629,98,0,0,0,0,41049,32980,16432,1305,65271,65535,65535,65535,65535,57343,57343,48887,65535,65535,65535,4748,20612,65535,65535,65535,46501,27771,32882,196,24657,0,0,57425,16563,49506,28443,22292,40742,16166,7974,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,7974,16166,40742,22292,28443,57698,16563,81,0,0,16465,196,41074,27771,38309,65535,65535,65535,28804,62092,65535,65535,65535,7663,7927,7927,9521,33312,56551,8191,65535,65535,56014,41472,139,196,49176,8273,196,24665,512,7197,32550,32038,32038,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,40230,32038,32038,32550,15389,512,16473,8388,16465,49176,57540,16523,41472,47566,65535,65535,8191,64751,49696,58673,7927,7927,7663,9257,42273,42273,57779,57540,1049,13196,65535,65535,57079,23518,27499,16416,57572,16596,24625,57352,0,33280,8961,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,58112,8961,33280,0,57352,16433,16596,237,16416,19299,23518,57079,65535,65535,21388,42008,57540,436,42017,42273,9257,8224,24608,32800,24755,49348,24608,35179,5805,65007,65535,65535,5277,43330,49571,41082,0,1280,26880,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,26880,1280,0,32890,57763,43330,54428,65535,65535,65263,5805,19059,16433,41156,32947,32800,24608,32,40968,40968,40968,16384,8192,32833,114,0,39374,65535,65535,65535,8191,58657,0,0,53512,32528,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,32528,53768,0,0,42273,65271,65535,65535,65535,56014,0,139,24731,8192,16384,40968,40968,40968,0,0,0,0,0,8241,8347,16514,18530,29060,65535,65535,40959,17449,1024,62216,14864,32528,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,24080,32528,14864,62216,1024,1057,32767,65535,65535,37252,51298,16547,49331,24625,0,0,0,0,0,0,0,16,130,57466,8306,24706,41139,57376,25889,7399,56551,56022,33569,1792,23568,14864,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14608,14864,23568,1792,25121,47830,56551,7399,42273,8216,24813,32947,114,57466,8322,57360,0,0,0,0,32923,16506,40992,57376,49184,24,0,0,24848,33040,8208,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8208,33040,16656,0,0,8208,8216,57376,40992,114,32931,40976,0,40960,41049,24723,2346,44290,19714,19714,19714,52490,44042,3074,60418,3074,52490,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,60426,52490,3074,60418,3074,44042,52490,19722,19714,19714,44290,59690,24723,32923,32792,32768,8249,0,63508,7975,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,48934,7975,22549,0,32939,8322,40960,16490,32939,9778,18689,26625,26625,26625,26625,26625,26625,59393,18441,9985,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,59137,9985,18441,59393,18433,26625,26625,26625,26625,26625,10497,42538,32964,16539,32808,0,0,114,57466,8240,49208,49208,49208,49208,49208,49208,8208,0,25376,42025,17449,17449,17449,17449,17449,17449,17449,25641,25641,25641,25641,17449,17449,17449,17449,17449,17449,17449,17449,17449,17449,17449,17449,25641,25641,25641,25641,17449,17449,17449,17449,17449,17449,17449,42025,25376,0,16,8240,24624,24624,24624,24624,24624,49200,114,32931,24608,0,0,0,40976,8306,8257,8257,8257,8257,8257,8257,32915,8298,16640,47566,8191,48887,48887,48887,48887,48887,48887,65535,65535,65535,65535,65535,16383,48887,48887,48887,48887,48887,48887,48887,48887,48887,48887,16383,65535,65535,65535,65535,65535,48887,48887,48887,48887,48887,48887,8191,55758,24832,49258,32988,24764,16572,16572,16572,16572,41156,24755,8192,0,0,0,0,0,0,0,0,0,0,0,0,16,41049,49408,15326,65535,65535,65535,65535,65535,65535,65535,30389,36996,4492,61572,61572,48359,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,56551,61572,61572,4492,36996,22197,65535,65535,65535,65535,65535,65535,65535,23518,24832,49274,8331,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24600,24665,49408,47830,65535,65535,65535,65535,65535,49151,8191,18762,0,0,0,0,46509,32767,65535,65535,65535,65535,65535,65535,65535,65535,32767,62893,0,0,0,0,2378,8191,49151,65535,65535,65535,65535,65535,56022,24832,32890,49290,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32792,24665,49408,47830,65535,65535,65535,65535,65535,22726,17969,528,0,0,0,0,17441,27482,65535,65535,65535,65535,65535,65535,65535,65535,35674,17441,0,0,0,0,57608,17969,6342,65535,65535,65535,65535,65535,56022,24832,32890,57482,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32792,24665,49408,47830,65535,65535,65535,24575,39374,44659,0,0,0,0,0,0,0,57872,5813,64478,65535,65535,65535,65535,64478,14005,792,0,0,0,0,0,0,0,36467,39374,16383,65535,65535,65535,56022,24832,32890,57482,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32792,24665,49408,47830,65535,65535,65535,15855,49944,0,0,0,0,0,0,0,0,0,0,61043,65535,65535,65535,65535,12155,0,0,0,0,0,0,0,0,0,0,41752,7663,65535,65535,65535,56022,24832,32890,57482,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,57425,16640,31710,65535,65535,65535,15855,25368,0,0,0,0,0,0,0,0,0,0,44659,65535,65535,65535,65535,61043,0,0,0,0,0,0,0,0,0,0,17176,7663,65535,65535,65535,39902,256,8314,139,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8249,32890,49432,47302,24311,65535,65535,15855,49944,0,0,0,0,0,0,0,0,0,0,61043,65535,65535,65535,65535,12155,0,0,0,0,0,0,0,0,0,0,41752,7663,65535,65535,24311,55494,272,41107,24715,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32808,8306,49331,33593,60506,65535,65535,7663,8720,0,0,0,0,0,0,0,0,0,0,60779,65535,65535,65535,65535,11891,0,0,0,0,0,0,0,0,0,0,528,64743,65535,65535,3163,9009,57548,32890,8224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,57458,24608,34873,65535,65535,16119,60779,42545,0,0,0,0,0,0,0,49416,43338,62629,65535,65535,65535,65535,5549,43338,49416,0,0,0,0,0,0,0,34353,60779,7927,65535,65535,51257,8208,24804,24584,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,57384,18746,65535,65535,65535,65535,13741,0,0,0,0,0,0,0,58401,40959,65535,65535,65535,65535,65535,65535,49151,9513,0,0,0,0,0,0,0,62629,65535,65535,65535,65535,35130,40984,41188,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,49241,204,58251,27218,47037,65535,65535,31975,5549,9777,0,0,0,0,28275,47037,49151,65535,65535,65535,65535,65535,65535,57343,47037,36467,0,0,0,0,1585,5549,31975,65535,65535,55229,27218,58251,49348,16498,32768,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16474,16555,0,29332,65535,65535,65535,65535,11891,1057,17441,17441,17441,31182,65535,65535,65007,23518,39902,39902,23518,65007,65535,65535,47566,17441,17441,17441,1057,60779,65535,65535,65535,65535,45972,0,8355,32866,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40976,24731,0,54428,65535,65535,65535,65535,24311,15855,32239,32239,24047,16383,65535,65535,13212,16912,33296,33296,16912,62100,65535,65535,16383,32239,32239,32239,15855,16119,65535,65535,65535,65535,5277,0,24731,57360,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40976,49307,8306,60027,21652,48887,65535,65535,65535,65535,65535,65535,65535,65535,40431,13212,2378,0,0,0,0,59458,5020,32239,65535,65535,65535,65535,65535,65535,65535,65535,48887,21652,60283,8306,57507,49168,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16408,16564,32874,256,15591,65535,65535,65535,65535,65535,65535,65535,65535,6870,0,0,0,0,0,0,0,0,55758,65535,65535,65535,65535,65535,65535,65535,65535,23783,256,16482,24764,16408,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32849,32996,57515,34353,4476,65535,65535,65535,65535,65535,65535,65535,32503,63686,52058,0,0,0,0,35674,63686,32503,65535,65535,65535,65535,65535,65535,65535,12668,34353,57515,32996,41049,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24649,16621,8257,1882,47566,39374,31446,40959,65535,65535,65535,65535,65535,54437,58665,9777,9777,58665,46245,65535,65535,65535,65535,65535,40959,39638,39374,47566,18522,65,16621,32841,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,41009,24755,57499,256,24576,9513,8191,65535,65535,65535,65535,65535,32767,57079,65271,65271,57079,32767,65535,65535,65535,65535,65535,16383,17705,24576,256,49307,24755,41009,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,49160,24731,49282,57376,8456,52587,28539,36731,56286,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,64478,36731,28539,52587,16648,49184,41090,24731,49160,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,16638,16465,0,0,0,0,38317,16383,48887,48887,48887,48887,48887,48887,48887,48887,16383,54701,0,0,0,0,81,16638,8306,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24682,24731,8241,8,25368,48094,20876,0,49680,17441,1057,58136,1057,25897,25897,1057,58136,1057,17441,49680,0,12684,56286,33560,8,8241,24731,106,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32898,8404,16498,0,0,8984,6342,3963,0,17705,51001,26425,34617,18233,16384,8192,18233,34617,26425,51001,17705,0,61043,22726,17176,0,0,8322,24723,41000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16384,8298,33005,57376,0,0,0,0,0,0,0,14269,65535,65535,65535,57343,58665,42281,57343,65535,65535,65535,30653,0,0,0,0,0,0,0,16408,41172,32874,16384,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16498,188,57425,40968,0,0,0,33296,37524,19290,0,47037,65535,65535,65535,65535,9777,58665,65535,65535,65535,65535,63421,0,11098,37524,33296,0,0,0,49160,16465,49339,32882,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32898,49372,8546,16896,0,57344,8984,40960,9249,65535,46245,0,46245,40431,7663,15855,48359,25897,9513,48359,15855,7663,40431,62629,0,21669,65535,17441,32768,8984,57344,0,16896,57698,49372,41090,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,49274,24772,40976,53652,31710,41224,10570,56551,10041,57344,65535,5549,0,8456,528,49416,57608,49416,16384,16384,49416,57608,49416,528,8456,0,54437,65535,264,58929,56551,26954,33032,23518,4500,40968,24764,122,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32768,24715,57540,25475,59978,6598,40959,49416,43602,65535,45716,11098,62629,11363,0,26425,59986,19026,27218,19026,57608,57608,10834,35410,19026,59986,34617,0,3171,5549,19290,37524,65535,59986,41224,32767,22990,59978,17283,57540,32915,32768,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,40960,40960,32768,8192,24600,16621,57360,43321,65535,65535,15855,49416,10834,65535,65535,56551,49152,0,0,55229,65535,65535,65535,65535,9777,58665,65535,65535,65535,65535,6342,0,0,40960,40167,65535,65535,27218,41224,7663,65535,65535,59705,49168,16621,40984,8192,32768,40960,40960,24576,0,0,0,0,0,0,0,0,0,0,0,114,24682,8216,8216,32841,49380,8314,8249,29076,55750,65535,65535,24311,33552,25104,10834,6606,24575,54965,52058,0,30653,65535,65535,65535,65535,9777,58665,65535,65535,65535,65535,47037,0,43866,54965,24575,14798,10834,33296,25360,16119,65535,65535,55750,37268,16441,57458,49380,41033,8216,8216,24723,8314,0,0,0,0,0,0,0,0,49160,8331,24780,33394,42273,42273,9042,41188,41586,26137,56551,65535,65535,7663,47302,17209,16400,0,46245,65535,65535,46509,33825,38053,15326,64214,15326,47830,58401,50209,47830,15326,64214,15326,46245,33825,38317,65535,65535,62885,0,16400,17209,39110,7655,65535,65535,64999,34329,33394,41188,17234,42273,42273,8835,212,16523,49160,0,0,0,0,0,0,24600,196,49168,3707,7919,7927,30389,0,44923,24311,49151,65535,65535,11875,16640,8421,49315,0,63149,65535,65535,16383,56815,26690,0,0,8192,0,0,0,0,8192,0,0,18498,56815,16383,65535,65535,13997,0,32923,16621,16640,61027,65535,65535,49151,24311,61315,0,21941,7927,7919,3707,40976,196,40984,0,0,0,0,0,0,24600,32947,0,20595,65535,65535,31975,11619,55485,65535,65535,64734,21132,42610,24714,41139,32923,49274,11131,46236,57079,65535,65535,62100,52323,36203,36203,36203,11891,11891,36203,36203,36203,52323,53908,65535,65535,57079,54428,19323,49274,24731,41139,24714,42610,20868,56542,65535,65535,6334,3427,23783,65535,65535,45179,0,32947,32792,0,0,0,0,0,0,32792,41156,0,3955,65535,49151,65535,65535,65535,65535,65535,54701,0,155,16555,8192,57,49372,73,8704,24047,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,32239,25088,49225,49372,16441,8192,8363,8347,0,38317,65535,65535,65535,65535,65535,49151,65535,20347,0,41156,40984,0,0,0,0,0,0,8,41131,49348,50042,43057,10025,11619,65535,65535,40695,43594,25682,16588,41115,0,0,0,24698,16465,58376,57079,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65271,9224,81,32890,0,0,0,32923,24780,33874,35402,32503,65535,65535,20067,10025,43057,42106,49348,41131,8200,0,0,0,0,0,0,0,40960,57499,179,49209,49209,33874,30918,64999,65271,10818,9042,8404,41107,49160,0,0,49274,49299,25401,14269,55750,47302,7927,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,7927,55494,55750,22461,41793,41107,122,0,0,49160,32915,16596,9042,2370,57079,7655,30918,42322,49209,49209,57515,155,40968,0,0,0,0,0,0,0,0,0,49160,8273,8323,147,16563,32768,37260,65535,40959,5813,16384,139,32,0,0,49168,41107,49372,24584,0,0,63677,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,22726,0,0,16392,41172,49299,57360,0,0,57376,139,16384,54701,40959,65535,53900,32768,16555,8339,8323,8273,49160,0,0,0,0,0,0,0,0,0,0,0,0,0,24592,24739,0,4484,65535,65535,6069,0,49274,57376,0,0,0,0,8355,8355,16531,32906,19059,44915,44651,63413,65535,65535,65535,65535,6069,44651,44915,27251,32906,16531,163,16547,0,0,0,0,49184,49274,0,55221,65535,65535,20876,0,24739,32784,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32792,49331,49160,53380,8183,8183,46509,49160,32915,57376,0,0,0,0,8,16523,16539,41180,8273,0,0,44395,8183,32503,32503,8183,60787,0,0,81,49372,16539,24715,8200,0,0,0,0,49184,32915,49160,30125,8183,8183,4236,49160,49331,40984,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,57352,8355,8404,25450,9497,9497,17234,24780,49307,8,0,0,0,0,0,0,0,24633,212,41156,16596,41594,1305,1305,1305,1305,41594,16596,41156,212,32833,0,0,0,0,0,0,0,8,41115,24780,25426,9497,9497,25450,8404,8355,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24576,8339,57531,41041,41041,8347,41099,32768,0,0,0,0,0,0,0,0,0,16,57376,49299,57531,57425,49233,49233,57425,49339,57491,57376,24,0,0,0,0,0,0,0,0,0,32768,32907,8347,41041,41041,49339,16531,24576,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,49274,41090,41090,57466,8200,0,0,0,0,0,0,0,0,0,0,0,0,32768,41033,8323,24706,24706,8323,49225,32768,0,0,0,0,0,0,0,0,0,0,0,0,8,49274,41090,41090,57466,8200,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};

const uint16_t smile[]=
{
0,0,0,0,0,0,0,0,0,0,0,15591,49944,0,0,0,0,0,0,49944,15591,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32767,48359,15591,23783,22990,42545,41752,49944,49944,49944,49944,41752,42545,22990,23783,15591,48359,32767,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40167,58929,25368,25368,34353,14798,23783,15591,15591,15591,15591,23783,14798,34353,0,0,58929,40167,0,0,0,0,0,0,0,0,0,0,0,0,32767,56551,14798,34353,25368,25368,58929,40167,16142,16142,16142,16142,16142,16142,40167,58929,0,0,34353,14798,56551,32767,0,0,0,0,0,0,0,0,0,0,40167,50737,17969,14798,23783,7399,40167,32767,16142,16142,16142,16142,16142,16142,32767,40167,7399,23783,14798,17969,50737,40167,0,0,0,0,0,0,0,0,32767,56551,14798,17969,50737,40167,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,40167,50737,17969,14798,56551,32767,0,0,0,0,0,0,40167,50737,17969,14798,56551,32767,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,32767,56551,14798,17969,50737,40167,0,0,0,0,32767,56551,14798,17969,50737,40167,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,40167,50737,17969,14798,56551,32767,0,0,48359,58929,34353,14798,56551,32767,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,32767,56551,14798,34353,58929,48359,0,0,15591,33560,33560,15591,16142,16142,32767,40167,7399,7399,40167,32767,16142,16142,16142,16142,16142,16142,32767,40167,7399,7399,40167,32767,16142,16142,15591,33560,33560,15591,0,0,15591,33560,33560,15591,16142,16142,40167,10041,41752,41752,10041,40167,16142,16142,16142,16142,16142,16142,40167,10041,41752,41752,10041,40167,16142,16142,15591,33560,33560,15591,0,23783,22990,34353,58929,40167,16142,16142,15591,49944,0,0,49944,15591,16142,16142,16142,16142,16142,16142,15591,49944,0,0,49944,15591,16142,16142,40167,58929,34353,22990,23783,41752,42545,14798,56551,32767,16142,16142,15591,49944,0,0,49944,15591,16142,16142,16142,16142,16142,16142,15591,49944,0,0,49944,15591,16142,16142,32767,56551,14798,42545,41752,0,49944,15591,16142,16142,16142,16142,40167,10041,41752,41752,10041,40167,16142,16142,16142,16142,16142,16142,40167,10041,41752,41752,10041,40167,16142,16142,16142,16142,15591,49944,0,0,49944,15591,16142,16142,16142,16142,32767,40167,7399,7399,40167,32767,16142,16142,16142,16142,16142,16142,32767,40167,7399,7399,40167,32767,16142,16142,16142,16142,15591,49944,0,0,49944,15591,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,15591,49944,0,0,49944,15591,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,15591,49944,0,0,49944,15591,16142,16142,16142,16142,32767,40167,40167,32767,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,32767,40167,40167,32767,16142,16142,16142,16142,15591,49944,0,0,49944,15591,16142,16142,16142,16142,40167,42545,42545,40167,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,40167,42545,42545,40167,16142,16142,16142,16142,15591,49944,0,41752,42545,14798,56551,32767,16142,16142,40167,50737,17969,14798,56551,32767,16142,16142,16142,16142,16142,16142,32767,56551,14798,17969,50737,40167,16142,16142,32767,56551,14798,42545,41752,23783,22990,34353,58929,40167,16142,16142,32767,56551,14798,17969,50737,40167,16142,16142,16142,16142,16142,16142,40167,50737,17969,14798,56551,32767,16142,16142,40167,58929,34353,22990,23783,0,15591,33560,33560,15591,16142,16142,16142,16142,40167,50737,17969,14798,23783,15591,15591,15591,15591,23783,14798,17969,50737,40167,16142,16142,16142,16142,15591,33560,33560,15591,0,0,15591,33560,33560,15591,16142,16142,16142,16142,32767,56551,14798,34353,25368,33560,33560,33560,33560,25368,34353,14798,56551,32767,16142,16142,16142,16142,15591,33560,33560,15591,0,0,48359,58929,34353,14798,56551,32767,16142,16142,16142,16142,40167,58929,25368,33560,33560,33560,33560,25368,58929,40167,16142,16142,16142,16142,32767,56551,14798,34353,58929,48359,0,0,32767,56551,14798,17969,50737,40167,16142,16142,16142,16142,32767,40167,7399,15591,15591,15591,15591,7399,40167,32767,16142,16142,16142,16142,40167,50737,17969,14798,56551,32767,0,0,0,0,40167,50737,17969,14798,56551,32767,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,32767,56551,14798,17969,50737,40167,0,0,0,0,0,0,32767,56551,14798,17969,50737,40167,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,16142,40167,50737,17969,14798,56551,32767,0,0,0,0,0,0,0,0,40167,50737,17969,14798,23783,7399,40167,32767,16142,16142,16142,16142,16142,16142,32767,40167,7399,23783,14798,17969,50737,40167,0,0,0,0,0,0,0,0,0,0,32767,56551,14798,34353,25368,25368,58929,40167,16142,16142,16142,16142,16142,16142,40167,58929,25368,25368,34353,14798,56551,32767,0,0,0,0,0,0,0,0,0,0,0,0,40167,58929,25368,25368,34353,14798,23783,15591,15591,15591,15591,23783,14798,34353,25368,25368,58929,40167,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32767,48359,15591,23783,22990,42545,41752,49944,49944,49944,49944,41752,42545,22990,23783,15591,48359,32767,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15591,49944,0,0,0,0,0,0,49944,15591,0,0,0,0,0,0,0,0,0,0,0,
};

//Global Variables for the game
//Variables declared for our main character Luffy
int hinverted = 0;
int vinverted = 0;
int toggle = 0;
int hmoved = 0;
int vmoved = 0;
uint16_t x = 55;
uint16_t y = 140;


//Variables for enemy
uint16_t enemyX = 55;
uint16_t enemyY = 65;
int deltaX = 1;

//Variables for the meat
uint16_t meatX = 55;
uint16_t meatY = 20;

//Global Variable
int continue_game = 0;

int main()
{	

	uint16_t oldx = x;
	uint16_t oldy = y;

	setUpSystem();
	renderGame();
	renderAssets();
	renderBarriers();

	while(1)
	{
		hmoved = vmoved = 0;
		hinverted = vinverted = 0;

		//Enemy Movement
		if (enemyX > 100)
		{
			deltaX = -1;
		}
		
		if (enemyX < 1)
		{
			deltaX = 1;
		}

		fillRectangle(enemyX,enemyY,12,16,RGBToWord(102,51,0));
		
		enemyX = enemyX + deltaX;

		putImage(enemyX,enemyY,12,16,enemy,0,0);

		enemyInsidePlayer(enemyX,enemyY,x,y);

		//Luffy Movement
		//Deletes the original image off the spawn
	
		if (rightPressed() == 0 || leftPressed() == 0 || upPressed() == 0 || downPressed() == 0)
		{
			putImage(x,y,12,16,delete,0,0);
		}
		

		if (rightPressed() == 0) // right pressed
		{					
			if (x < 110)
			{
				x = x + 2;
				hmoved = 1;
				hinverted=0;
			}						
		}
		if (leftPressed() == 0) // left pressed
		{			
			
			if (x > 10)
			{
				x = x - 2;
				hmoved = 1;
				hinverted=1;
			}			
		}
		if ( downPressed() == 0) // down pressed
		{
			if (y < 140)
			{
				y = y + 2;			
				vmoved = 1;
				vinverted = 0;
			}
		}
		if (upPressed() == 0 ) // up pressed
		{			
			if (y > 16)
			{
				y = y - 2;
				vmoved = 1;
				vinverted = 1;
				
			}
		}
		if ((vmoved) || (hmoved))
		{
			// only redraw if there has been some movement (reduces flicker)
			fillRectangle(oldx,oldy,12,16,RGBToWord(102,51,0));
			
			oldx = x;
			oldy = y;					
			
			if (hmoved)
			{
				if (toggle)
					putImage(x,y,12,16,luffy2,hinverted,0);
				else
					putImage(x,y,12,16,luffy3,hinverted,0);

				
				toggle = toggle ^ 1;
			}
			else
			{
				putImage(x,y,12,16,luffy4,0,hinverted);
			}
			playerInsideEnemy(x,y,enemyX,enemyY);
			playerInsideMeat(x,y,meatX,meatY);
			
			if (hitOcean(x,y,12,16) == 1)
			{
				gameOver();
			}
			
		}		
		delay(50);
	}
	return 0;
}
void setUpSystem()
{
	initClock();
	initSysTick();
	setupIO();
}
void initSysTick(void)
{
	SysTick->LOAD = 48000;
	SysTick->CTRL = 7;
	SysTick->VAL = 10;
	__asm(" cpsie i "); // enable interrupts
}
void SysTick_Handler(void)
{
	milliseconds++;
}
void initClock(void)
{
// This is potentially a dangerous function as it could
// result in a system with an invalid clock signal - result: a stuck system
        // Set the PLL up
        // First ensure PLL is disabled
        RCC->CR &= ~(1u<<24);
        while( (RCC->CR & (1 <<25))); // wait for PLL ready to be cleared
        
// Warning here: if system clock is greater than 24MHz then wait-state(s) need to be
// inserted into Flash memory interface
				
        FLASH->ACR |= (1 << 0);
        FLASH->ACR &=~((1u << 2) | (1u<<1));
        // Turn on FLASH prefetch buffer
        FLASH->ACR |= (1 << 4);
        // set PLL multiplier to 12 (yielding 48MHz)
        RCC->CFGR &= ~((1u<<21) | (1u<<20) | (1u<<19) | (1u<<18));
        RCC->CFGR |= ((1<<21) | (1<<19) ); 

        // Need to limit ADC clock to below 14MHz so will change ADC prescaler to 4
        RCC->CFGR |= (1<<14);

        // and turn the PLL back on again
        RCC->CR |= (1<<24);        
        // set PLL as system clock source 
        RCC->CFGR |= (1<<1);
}
void delay(volatile uint32_t dly)
{
	uint32_t end_time = dly + milliseconds;
	while(milliseconds != end_time)
		__asm(" wfi "); // sleep
}

void enablePullUp(GPIO_TypeDef *Port, uint32_t BitNumber)
{
	Port->PUPDR = Port->PUPDR &~(3u << BitNumber*2); // clear pull-up resistor bits
	Port->PUPDR = Port->PUPDR | (1u << BitNumber*2); // set pull-up bit
}
void pinMode(GPIO_TypeDef *Port, uint32_t BitNumber, uint32_t Mode)
{
	/*
	*/
	uint32_t mode_value = Port->MODER;
	Mode = Mode << (2 * BitNumber);
	mode_value = mode_value & ~(3u << (BitNumber * 2));
	mode_value = mode_value | Mode;
	Port->MODER = mode_value;
}
int isInside(uint16_t x1, uint16_t y1, uint16_t w, uint16_t h, uint16_t px, uint16_t py)
{
	// checks to see if point px,py is within the rectange defined by x,y,w,h
	uint16_t x2,y2;
	x2 = x1+w;
	y2 = y1+h;
	int rvalue = 0;
	if ( (px >= x1) && (px <= x2))
	{
		// ok, x constraint met
		if ( (py >= y1) && (py <= y2))
			rvalue = 1;
	}
	return rvalue;
}

void setupIO()
{
	RCC->AHBENR |= (1 << 18) + (1 << 17); // enable Ports A and B
	display_begin();
	pinMode(GPIOB,4,0);
	pinMode(GPIOB,5,0);
	pinMode(GPIOA,8,0);
	pinMode(GPIOA,11,0);
	enablePullUp(GPIOB,4);
	enablePullUp(GPIOB,5);
	enablePullUp(GPIOA,11);
	enablePullUp(GPIOA,8);
}
int leftPressed()
{
	if ((GPIOB->IDR & (1 << 5))==0)// left pressed
	{
		return 0;
	}
	else
	{
		return 1;
	}

}

int rightPressed()
{
	if ((GPIOB->IDR & (1 << 4))==0)// right pressed
	{
		return 0;
	}
	else
	{
		return 1;
	}
}

int downPressed()
{
	if ((GPIOA->IDR & (1 << 11)) == 0)// down pressed
	{
		return 0;
	}
	else
	{
		return 1;
	}	
}

int upPressed()
{
	if ((GPIOA->IDR & (1 << 8)) == 0)// up pressed
	{
		return 0;
	}
	else
	{
		return 1;
	}		
}

void gameOver()
{
	fillRectangle(0,0,128,160,0);
	fillRectangle(40,0,45,179,0);
	fillRectangle(0,65,128,20,0);
	
	while (1)
	{
		printTextX2(" Game Over ",0,0,255,0);
		putImage(30,40,64,67,skull,0,0);
	}	
}

void enemyInsidePlayer(uint16_t enemyX,uint16_t enemyY,uint16_t x ,uint16_t y)
{
	// Now check for an overlap by checking to see if ANY of the 4 corners of Luffy are within the enemy area
	if (isInside(x,y,12,16,enemyX,enemyY) || isInside(x,y,12,16,enemyX+12,enemyY) || isInside(x,y,12,16,enemyX,enemyY+16) || isInside(x,y,12,16,enemyX+12,enemyY+16) )
	{
		gameOver();
	}
}

void playerInsideEnemy(uint16_t x,uint16_t y,uint16_t enemyX ,uint16_t enemyY)
{
	// Now check for an overlap by checking to see if ANY of the 4 corners of Luffy are within the enemy area
	if (isInside(enemyX,enemyY,12,16,x,y) || isInside(enemyX,enemyY,12,16,x+12,y) || isInside(enemyX,enemyY,12,16,x,y+16) || isInside(enemyX,enemyY,12,16,x+12,y+16) )
	{
		gameOver();
	}
}

void playerInsideMeat(uint16_t x,uint16_t y,uint16_t meatX,uint16_t meatY)
{	
	// Now check for an overlap by checking to see if ANY of the 4 corners of Luffy are within the enemy area
	if (isInside(meatX,meatY,12,16,x,y) || isInside(meatX,meatY,12,16,x+12,y) || isInside(meatX,meatY,12,16,x,y+16) || isInside(meatX,meatY,12,16,x+12,y+16) )
	{	
		levelCompleted();
	}
}

void levelCompleted(void)
{
	while (continue_game == 0)
		{
			printText("Level Completed",8,10,255,0);
            printText("Right Button", 8, 20, 255, 0);
            printText("To begin", 8, 30, 255, 0);
			printText("Next level!", 8, 40, 255, 0);

			fillRectangle(0,0,128,160,0);
			fillRectangle(40,0,45,179,0);
			fillRectangle(0,65,128,20,0);

			putImage(64-32,80-32,32,32,smile,0,0);	

            if (rightPressed() == 0) // right pressed
            {    
            	continue_game = 1;    
                
				while (1)
                {
					printText("Level 2",10,120,255,0);
					printText("Loading....",10,140,255,0);

					delay(1000);
					level2();
                } 
			}
		}
}

void level2(void)
{

	delay(1000);
	
	x = 55;
	y = 140;

	uint16_t oldx = x;
	uint16_t oldy = y;

	renderGame();
	
	putImage(55,140,12,16,luffy1,0,0);
	putImage(55,20,12,16,meat,0,0);

	renderBarriers();

	while (1)
	{
		hmoved = vmoved = 0;
		hinverted = vinverted = 0;

		//Enemy Movement
		if (enemyX > 100)
		{
			deltaX = -1;
		}
		
		if (enemyX < 1)
		{
			deltaX = 1;
		}

		fillRectangle(enemyX,enemyY,12,16,RGBToWord(102,51,0));
		
		enemyX = enemyX + deltaX;

		putImage(enemyX,enemyY,12,16,enemy,0,0);

		enemyInsidePlayer(enemyX,enemyY,x,y);

		//Luffy Movement
		//Deletes the original image off the spawn
	
		if (rightPressed() == 0 || leftPressed() == 0 || upPressed() == 0 || downPressed() == 0)
		{
			putImage(x,y,12,16,delete,0,0);
		}
		

		if (rightPressed() == 0) // right pressed
		{					
			if (x < 110)
			{
				x = x + 2;
				hmoved = 1;
				hinverted=0;
			}						
		}
		if (leftPressed() == 0) // left pressed
		{			
			
			if (x > 10)
			{
				x = x - 2;
				hmoved = 1;
				hinverted=1;
			}			
		}
		if ( downPressed() == 0) // down pressed
		{
			if (y < 140)
			{
				y = y + 2;			
				vmoved = 1;
				vinverted = 0;
			}
		}
		if (upPressed() == 0 ) // up pressed
		{			
			if (y > 16)
			{
				y = y - 2;
				vmoved = 1;
				vinverted = 1;
				
			}
		}
		if ((vmoved) || (hmoved))
		{
			// only redraw if there has been some movement (reduces flicker)
			fillRectangle(oldx,oldy,12,16,RGBToWord(102,51,0));
			
			oldx = x;
			oldy = y;					
			
			if (hmoved)
			{
				if (toggle)
					putImage(x,y,12,16,luffy2,hinverted,0);
				else
					putImage(x,y,12,16,luffy3,hinverted,0);

				
				toggle = toggle ^ 1;
			}
			else
			{
				putImage(x,y,12,16,luffy4,0,hinverted);
			}
			playerInsideEnemy(x,y,enemyX,enemyY);
			playerInsideMeat(x,y,meatX,meatY);
			
			if (hitOcean(x,y,12,16) == 1)
			{
				gameOver();
			}
			
		}		
		delay(50);
	}
}

void renderGame()
{
	//Sets the background of the game
	//The sea
	fillRectangle(0,0,128,160,RGBToWord(51,143,255));
	
	//Main bridge
	fillRectangle(40,0,45,179,RGBToWord(102,51,0));

	//Side bridge for the enemy
	fillRectangle(0,65,128,20,RGBToWord(102,51,0));
}

void renderAssets(void)
{
	putImage(55,65,12,16,enemy,0,0);
	putImage(55,140,12,16,luffy1,0,0);
	putImage(55,20,12,16,meat,0,0);
}

void renderBarriers(void)
{
	//Main bridge barriers are set
	for (int i=0;i<BLOCK_COUNT_TOP;i++)
		putImage(barrierX[i],barrierY[i],9,12,barrier,0,0);

	for (int i=0;i<BLOCK_COUNT_TOP;i++)
		putImage(barrier2X[i],barrier2Y[i],12,15,barrier,0,0);

	for (int i=0;i<BLOCK_COUNT_BOTTOM;i++)
		putImage(barrier3X[i],barrier3Y[i],9,12,barrier,0,0);

	for (int i=0;i<BLOCK_COUNT_BOTTOM;i++)
		putImage(barrier4X[i],barrier4Y[i],12,16,barrier,0,0);
	
	//Side bridge barrier set
	for (int i=0;i<BLOCK_COUNT_SIDE;i++)
		putImage(side_barrierX[i],side_barrierY[i],9,12,barrier,0,0);

	for (int i=0;i<BLOCK_COUNT_SIDE;i++)
		putImage(side_barrier2X[i],side_barrier2Y[i],9,12,barrier,0,0);

	for (int i=0;i<BLOCK_COUNT_SIDE;i++)
		putImage(side_barrier3X[i],side_barrier3Y[i],12,16,barrier,0,0);

	for (int i=0;i<BLOCK_COUNT_SIDE;i++)
		putImage(side_barrier4X[i],side_barrier4Y[i],12,16,barrier,0,0);
}

int hitOcean(uint16_t playerx,uint16_t playery,uint16_t w, uint16_t h)
{
	int rvalue = 0;
	
	int mazeblock=0;

	for (mazeblock = 0; mazeblock < BLOCK_COUNT_TOP; mazeblock++)
	{
		if (isInside(barrierX[mazeblock],barrierY[mazeblock],w,h,playerx,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrierX[mazeblock],barrierY[mazeblock],w,h,playerx+12,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrierX[mazeblock],barrierY[mazeblock],w,h,playerx+12,playery+16)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrierX[mazeblock],barrierY[mazeblock],w,h,playerx,playery+16)==1)
		{
			rvalue = 1;
			break;
		}

	}

	for (mazeblock = 0; mazeblock < BLOCK_COUNT_TOP; mazeblock++)
	{
		if (isInside(barrier2X[mazeblock],barrier2Y[mazeblock],w,h,playerx,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrier2X[mazeblock],barrier2Y[mazeblock],w,h,playerx+12,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrier2X[mazeblock],barrier2Y[mazeblock],w,h,playerx+12,playery+16)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrier2X[mazeblock],barrier2Y[mazeblock],w,h,playerx,playery+16)==1)
		{
			rvalue = 1;
			break;
		}

	}
	
	for (mazeblock = 0; mazeblock < BLOCK_COUNT_BOTTOM; mazeblock++)
	{
		if (isInside(barrier3X[mazeblock],barrier3Y[mazeblock],w,h,playerx,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrier3X[mazeblock],barrier3Y[mazeblock],w,h,playerx+12,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrier3X[mazeblock],barrier3Y[mazeblock],w,h,playerx+12,playery+16)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrier3X[mazeblock],barrier3Y[mazeblock],w,h,playerx,playery+16)==1)
		{
			rvalue = 1;
			break;
		}

	}

	for (mazeblock = 0; mazeblock < BLOCK_COUNT_BOTTOM; mazeblock++)
	{
		if (isInside(barrier4X[mazeblock],barrier4Y[mazeblock],w,h,playerx,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrier4X[mazeblock],barrier4Y[mazeblock],w,h,playerx+12,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrier4X[mazeblock],barrier4Y[mazeblock],w,h,playerx+12,playery+16)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(barrier4X[mazeblock],barrier4Y[mazeblock],w,h,playerx,playery+16)==1)
		{
			rvalue = 1;
			break;
		}

	}

	for (mazeblock = 0; mazeblock < BLOCK_COUNT_SIDE; mazeblock++)
	{
		if (isInside(side_barrierX[mazeblock],side_barrierY[mazeblock],w,h,playerx,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrierX[mazeblock],side_barrierY[mazeblock],w,h,playerx+9,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrierX[mazeblock],side_barrierX[mazeblock],w,h,playerx+9,playery+12)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrierX[mazeblock],side_barrierY[mazeblock],w,h,playerx,playery+12)==1)
		{
			rvalue = 1;
			break;
		}

	}

	for (mazeblock = 0; mazeblock < BLOCK_COUNT_SIDE; mazeblock++)
	{
		if (isInside(side_barrier2X[mazeblock],side_barrier2Y[mazeblock],w,h,playerx,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrier2X[mazeblock],side_barrier2Y[mazeblock],w,h,playerx+9,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrier2X[mazeblock],side_barrier2X[mazeblock],w,h,playerx+9,playery+12)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrier2X[mazeblock],side_barrier2Y[mazeblock],w,h,playerx,playery+12)==1)
		{
			rvalue = 1;
			break;
		}

	}

	for (mazeblock = 0; mazeblock < BLOCK_COUNT_SIDE; mazeblock++)
	{
		if (isInside(side_barrier3X[mazeblock],side_barrier3Y[mazeblock],w,h,playerx,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrier3X[mazeblock],side_barrier3Y[mazeblock],w,h,playerx+12,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrier3X[mazeblock],side_barrier3X[mazeblock],w,h,playerx+12,playery+16)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrier3X[mazeblock],side_barrier3Y[mazeblock],w,h,playerx,playery+16)==1)
		{
			rvalue = 1;
			break;
		}

	}

	for (mazeblock = 0; mazeblock < BLOCK_COUNT_SIDE; mazeblock++)
	{
		if (isInside(side_barrier4X[mazeblock],side_barrier4Y[mazeblock],w,h,playerx,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrier4X[mazeblock],side_barrier4Y[mazeblock],w,h,playerx+12,playery)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrier4X[mazeblock],side_barrier4X[mazeblock],w,h,playerx+12,playery+16)==1)
		{
			rvalue = 1;
			break;
		}
		if (isInside(side_barrier4X[mazeblock],side_barrier4Y[mazeblock],w,h,playerx,playery+16)==1)
		{
			rvalue = 1;
			break;
		}

	}
	return rvalue;
}